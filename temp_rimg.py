import datetime # Оставляем, так как он может быть использован другими функциями, если они будут добавлены
import time # Оставляем, так как он может быть использован другими функциями, если они будут добавлены
import random

# Важно: sleep_func, send_message_wrapper, edit_message_func, delete_message_func и plugin_instance
# будут доступны в глобальной области видимости этого динамически загружаемого модуля.
# log также доступен для отладки.

def cmd_delete_test(account, params):
    """
    Динамическая команда, которая демонстрирует удаление оригинального сообщения.
    Использование: .deltest
    """
    response_text = "Это сообщение появилось после удаления вашей команды!"
    # Возвращаем кортеж: текст сообщения и флаг удаления (True - удалить оригинал)
    return (response_text, True)

def cmd_random_image(account, params):
    """
    Тестовая команда для отправки случайного изображения и удаления команды.
    Использование: .rimg
    """
    try:
        # Генерируем случайные размеры для изображения
        width = random.randint(300, 800)
        height = random.randint(300, 800)
        
        # Генерируем случайный ID для получения уникального изображения
        # picsum.photos/seed/{seed}/width/height
        seed = random.randint(1000, 9999) 
        
        # Формируем ссылку на случайное изображение с picsum.photos
        image_url = f"https://picsum.photos/seed/{seed}/{width}/{height}"
        
        # Формируем текст ответа. Используем Markdown для создания кликабельной ссылки.
        # В тексте указываем prnt.sc для соответствия запросу пользователя.
        response_text = (
            f"Рандомное изображение:\n"
            f"[Просмотреть изображение (prnt.sc/генерировано)]({image_url})"
        )
        
        # Возвращаем кортеж: текст сообщения и флаг удаления (True - удалить оригинал)
        return (response_text, True)
    except Exception as e:
        error_text = f"Ошибка при генерации случайного изображения: {e}"
        # В случае ошибки возвращаем текст ошибки и не удаляем оригинал
        return (error_text, False)

